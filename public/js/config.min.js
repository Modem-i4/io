//$(document).ready(function () {
  $('select').select2({
    theme: 'bootstrap4'
  });

  $.ajaxSetup({
    headers: {
      //'X-CSRF-TOKEN': '{{csrf_token()}}'
      'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
  });

  /*$(function () {
    $('[data-toggle="tooltip"]').tooltip()
  })*/

    //Remove Item
    $('body').on("click", ".delete", function() {
      var $ele = $(this).parent().parent();
      var id= $(this).attr('data-id');
      var url = pathUrl+id;
  $.ajax({
    url: url,
    type: "DELETE",
    cache: false,
    success: function(dataResult){
      //var dataResult = JSON.parse(dataResult);
        if(dataResult.statusCode==200){
          $(".alert-msg div").removeClass().fadeIn(1000).addClass('text-success show').html(dataResult.msg).fadeOut(4000).removeClass('show');
          $ele.addClass('alert-danger').fadeOut(1500, function(){
            t.row( $ele )
            .remove()
            .draw();
          });
        } else if(dataResult.statusCode==404){
          $(".alert-msg div").removeClass().fadeIn(1000).addClass('text-danger show').html(dataResult.msg).fadeOut(5000).removeClass('show');
        } else if(dataResult.statusCode==600){
          $(".alert-msg div").removeClass().fadeIn(1000).addClass('text-warning show').html(dataResult.msg).fadeOut(5000).removeClass('show');
          $ele.addClass('alert-warning');
          setTimeout(function(){  $ele.removeClass('alert-warning'); }, 2000);
        } else {
          $(".alert-msg div").removeClass().fadeIn(1000).addClass('text-warning show').html('Невідома помилка');
        }
    }

  });
  return false;
});

//Remove Many Items
$('body').on("click", ".delete-many", function() {
      var $ele = $('.table tbody tr.selected');
      var ids = [];
      $('.table tbody tr.selected').each(function(){
        ids.push($(this).attr('data-id'));
      });
      var url = pathUrl+ids;
  $.ajax({
    url: url,
    type: "DELETE",
    cache: false,
    success: function(dataResult){
      //var dataResult = JSON.parse(dataResult);
        if(dataResult.statusCode==200){
          $(".alert-msg div").removeClass().fadeIn(1000).addClass('text-success show').html(dataResult.msg).fadeOut(4000).removeClass('show');
          $ele.addClass('alert-danger').fadeOut(1500, function(){
            t.rows( $ele )
            .remove()
            .draw();
          });
        } else if(dataResult.statusCode==600){
          $(".alert-msg div").removeClass().fadeIn(1000).addClass('text-warning show').html(dataResult.msg).fadeOut(5000).removeClass('show');
          $(".table tbody tr.selected[data-id='"+dataResult.id+"']").removeClass('selected').addClass('alert-warning');
          setTimeout(function(){  $ele.removeClass('alert-warning'); }, 2000);
        } else {
          $(".alert-msg div").removeClass().fadeIn(1000).addClass('text-warning show').html('Невідома помилка');
        }
    }

  });
  return false;
  });



  var t = $('#dt-all-checkbox').DataTable({
    "language": {
      "sProcessing":     "Завантаження...",
      "sSearch":         "Пошук&nbsp;:",
      "sLengthMenu":     "Показати _MENU_ елементів",
      "sInfo":           "Показано _START_ - _END_ з _TOTAL_ ",
      "sInfoEmpty":      "Показано 0 - 0 з 0 ",
      "sInfoFiltered":   "(фільтр з _MAX_ елементів)",
      "sInfoPostFix":    "",
      "sLoadingRecords": "Завантаження...",
      "sZeroRecords":    "Нічого не знайдено",
      "sEmptyTable":     "Дані відсутні",
      "oPaginate": {
          "sFirst":      "Початок",
          "sPrevious":   "Назад",
          "sNext":       "Вперед",
          "sLast":       "Кінець"
      },
      "oAria": {
          "sSortAscending":  ": сортувати в порядку зростання",
          "sSortDescending": ": сортувати в порядку спадання"
      },
      "select": {
              "rows": {
                  "_": "%d обрано",
                  "0": "Елементи не обрано",
                  "1": "1 обрано"
              }
      }
  },
  ajax: 'http://io.de/api/departments/all',
  deferRender: true,
     // processing: true,
     // serverSide: true,
  columns: [
    {'data':null, render:function(){return "<input type='checkbox'/>";}},
    { "data": "id" },
    { "data": "title", "render": function ( data, type, full, meta ) {
      return '<a href="" class="update" data-name="title" data-type="text" data-pk="'+full.id+'" data-url="'+pathUrl+'update_ajax" data-title="Введіть назву">'+data+'</a>';
    } },
    { "data": "parent_id" },
    {"data": "id"  ,  "render": function ( data, type, full, meta ) {
      return '<a href="" class="delete" data-id="'+data+'"><span class="icon-trash-o"></span></a>';
      }
    },

],
    columnDefs: [
       /*{
        "targets": -1,
        "data": null,
        "defaultContent": '<a href="" class="delete" data-id="1"><span class="icon-trash-o"></span></a>'
    },*/
      {
        "orderable": false, "targets": "no-sort" //add class="no-sort" to disable sorting in column
    },
      {
      orderable: false,
      className: 'select-checkbox select-checkbox-all',
      targets:   0
  }],
    select: {
      style:    'multi',
      selector: 'td:first-child'
  },
 // bSortClasses: false,
 //deferRender: true,
 //orderClasses: false,
    pagingType: 'first_last_numbers',
    order: [[ 1, 'asc' ]],
    pageLength: 25,
    "fnDrawCallback": function() {
      //Update Item
      var makeEdit = function() {
        $('.update').editable({
          //url: updateUrl,
          mode: 'inline',
            validate: function(value) {
              var value = $.trim(value);
              if(value == '') {
                return 'Заповніть поле';
              } else if (value.length < 3 || value.length > 200) {
                return 'Допустима кількість символів 3-200';
              }
          },
            success: function (dataResult, newValue) {
              //console.log(dataResult);
              if(dataResult.statusCode == 500) return dataResult.msg;
            }
          });
        }
        makeEdit();

      //Update Select
      var makeEditSelect = function() {
        $('.update-select').editable({
          validate: function(value) {
            var value = $.trim(value);
            if(value == '') {
              return 'Оберіть елемент';
            }
          },
          tpl: '<select></select>',
          mode: 'inline',
        // source: selectData,
          select2: {
              ajax: {
                data: function (params) {
                  var query = {
                    term: params.term,
                    type: 'query'
                  }
                  // Query parameters will be ?term=[term]&type=query
                  return query;
                }
              },
              dropdownParent: '.editable-inline',
              width: '200px',
              // dropdownAutoWidth: true,
              theme: 'bootstrap4'
              },

              display: function(value, response) {
                //return false;   //disable this method
              },
              success: function (response, newValue) {
                $(this).text(response.title);
                if(response.statusCode == 500) return response.msg;
              }
              //placeholder: $(this).data('value'),
              //width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
              //allowClear: Boolean($(this).data('allow-clear')) //allowClear: true,
              //multiple: true
        });
      }
      makeEditSelect();

  }
  });

//});
